{
    "sourceFile": "src/app/services/emailService.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1765300016719,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1765300016719,
            "name": "Commit-0",
            "content": "import nodemailer from 'nodemailer';\n\n// ConfiguraciÃ³n del transporter de nodemailer\nconst transporter = nodemailer.createTransport({\n  host: process.env.EMAIL_HOST,\n  port: parseInt(process.env.EMAIL_PORT || '587'),\n  secure: false, // true para 465, false para otros puertos\n  auth: {\n    user: process.env.EMAIL_USER,\n    pass: process.env.EMAIL_PASSWORD,\n  },\n});\n\n// Verificar configuraciÃ³n (opcional)\nexport const verifyEmailConfig = async () => {\n  try {\n    await transporter.verify();\n    console.log('âœ“ Servidor de correo configurado correctamente');\n    return true;\n  } catch (error) {\n    console.error('âœ— Error en configuraciÃ³n de correo:', error);\n    return false;\n  }\n};\n\ninterface TicketEmailData {\n  clientEmail: string;\n  clientName: string;\n  ticketId: string;\n  ticketTitle: string;\n  ticketDescription: string;\n}\n\ninterface CommentEmailData {\n  clientEmail: string;\n  clientName: string;\n  ticketId: string;\n  ticketTitle: string;\n  agentName: string;\n  commentMessage: string;\n}\n\ninterface CloseTicketEmailData {\n  clientEmail: string;\n  clientName: string;\n  ticketId: string;\n  ticketTitle: string;\n  closedAt: Date;\n}\n\n// Email cuando se crea un ticket\nexport const sendTicketCreatedEmail = async (data: TicketEmailData) => {\n  try {\n    const mailOptions = {\n      from: process.env.EMAIL_FROM,\n      to: data.clientEmail,\n      subject: `Ticket Creado: ${data.ticketTitle}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background-color: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }\n            .content { background-color: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; border-radius: 0 0 8px 8px; }\n            .ticket-info { background-color: white; padding: 20px; border-radius: 8px; margin: 20px 0; }\n            .label { font-weight: bold; color: #6b7280; }\n            .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 12px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>ðŸŽ« HelpDeskPro</h1>\n            </div>\n            <div class=\"content\">\n              <h2>Hola ${data.clientName},</h2>\n              <p>Tu ticket de soporte ha sido creado exitosamente.</p>\n              \n              <div class=\"ticket-info\">\n                <p><span class=\"label\">ID del Ticket:</span> ${data.ticketId}</p>\n                <p><span class=\"label\">TÃ­tulo:</span> ${data.ticketTitle}</p>\n                <p><span class=\"label\">DescripciÃ³n:</span></p>\n                <p style=\"white-space: pre-wrap;\">${data.ticketDescription}</p>\n              </div>\n              \n              <p>Nuestro equipo de soporte revisarÃ¡ tu solicitud y te responderÃ¡ a la brevedad posible.</p>\n              <p>Puedes hacer seguimiento de tu ticket en cualquier momento desde tu panel de cliente.</p>\n              \n              <div class=\"footer\">\n                <p>Este es un correo automÃ¡tico, por favor no respondas a este mensaje.</p>\n                <p>Â© 2025 HelpDeskPro - Sistema de GestiÃ³n de Tickets</p>\n              </div>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n    };\n\n    await transporter.sendMail(mailOptions);\n    console.log(`âœ“ Email de creaciÃ³n enviado a ${data.clientEmail}`);\n    return true;\n  } catch (error) {\n    console.error('âœ— Error enviando email de creaciÃ³n:', error);\n    return false;\n  }\n};\n\n// Email cuando un agente responde (agrega comentario)\nexport const sendAgentResponseEmail = async (data: CommentEmailData) => {\n  try {\n    const mailOptions = {\n      from: process.env.EMAIL_FROM,\n      to: data.clientEmail,\n      subject: `Nueva Respuesta en tu Ticket: ${data.ticketTitle}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background-color: #10b981; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }\n            .content { background-color: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; border-radius: 0 0 8px 8px; }\n            .response { background-color: white; padding: 20px; border-left: 4px solid #10b981; margin: 20px 0; }\n            .label { font-weight: bold; color: #6b7280; }\n            .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 12px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>ðŸ’¬ Nueva Respuesta</h1>\n            </div>\n            <div class=\"content\">\n              <h2>Hola ${data.clientName},</h2>\n              <p>Has recibido una nueva respuesta en tu ticket de soporte.</p>\n              \n              <p><span class=\"label\">Ticket:</span> ${data.ticketTitle}</p>\n              <p><span class=\"label\">Respondido por:</span> ${data.agentName}</p>\n              \n              <div class=\"response\">\n                <p style=\"white-space: pre-wrap;\">${data.commentMessage}</p>\n              </div>\n              \n              <p>Puedes ver todos los detalles y continuar la conversaciÃ³n en tu panel de cliente.</p>\n              \n              <div class=\"footer\">\n                <p>Este es un correo automÃ¡tico, por favor no respondas a este mensaje.</p>\n                <p>Â© 2025 HelpDeskPro - Sistema de GestiÃ³n de Tickets</p>\n              </div>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n    };\n\n    await transporter.sendMail(mailOptions);\n    console.log(`âœ“ Email de respuesta enviado a ${data.clientEmail}`);\n    return true;\n  } catch (error) {\n    console.error('âœ— Error enviando email de respuesta:', error);\n    return false;\n  }\n};\n\n// Email cuando se cierra un ticket\nexport const sendTicketClosedEmail = async (data: CloseTicketEmailData) => {\n  try {\n    const mailOptions = {\n      from: process.env.EMAIL_FROM,\n      to: data.clientEmail,\n      subject: `Ticket Cerrado: ${data.ticketTitle}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background-color: #6b7280; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }\n            .content { background-color: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; border-radius: 0 0 8px 8px; }\n            .info-box { background-color: white; padding: 20px; border-radius: 8px; margin: 20px 0; }\n            .label { font-weight: bold; color: #6b7280; }\n            .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 12px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>âœ… Ticket Cerrado</h1>\n            </div>\n            <div class=\"content\">\n              <h2>Hola ${data.clientName},</h2>\n              <p>Tu ticket de soporte ha sido cerrado.</p>\n              \n              <div class=\"info-box\">\n                <p><span class=\"label\">ID del Ticket:</span> ${data.ticketId}</p>\n                <p><span class=\"label\">TÃ­tulo:</span> ${data.ticketTitle}</p>\n                <p><span class=\"label\">Fecha de cierre:</span> ${new Date(data.closedAt).toLocaleDateString('es-ES', {\n                  year: 'numeric',\n                  month: 'long',\n                  day: 'numeric',\n                  hour: '2-digit',\n                  minute: '2-digit'\n                })}</p>\n              </div>\n              \n              <p>Esperamos que tu problema haya sido resuelto satisfactoriamente.</p>\n              <p>Si necesitas ayuda adicional, no dudes en crear un nuevo ticket.</p>\n              <p>Â¡Gracias por usar HelpDeskPro!</p>\n              \n              <div class=\"footer\">\n                <p>Este es un correo automÃ¡tico, por favor no respondas a este mensaje.</p>\n                <p>Â© 2025 HelpDeskPro - Sistema de GestiÃ³n de Tickets</p>\n              </div>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n    };\n\n    await transporter.sendMail(mailOptions);\n    console.log(`âœ“ Email de cierre enviado a ${data.clientEmail}`);\n    return true;\n  } catch (error) {\n    console.error('âœ— Error enviando email de cierre:', error);\n    return false;\n  }\n};\n"
        }
    ]
}